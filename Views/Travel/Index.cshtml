@model UtilizationTrackerApp.Models.Data.TravelHistory_Model
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js" integrity="sha512-YHQNqPhxuCY2ddskIbDlZfwY6Vx3L3w9WRbyJCY81xpqLmrM6rL2+LocBgeVHwGY9SXYfQWJ+lcEWx1fKS2s8A==" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
@*<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" />
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>*@
@*<link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css' />*@
 
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">

            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Add Travel Bill</li>
                </ol>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
<section class="content">



    @using (Html.BeginForm("Index", "Travel", FormMethod.Post))
    {
        @Html.Partial("_NotificationComponent")
        <div class="container-fluid">
            <div class="card card-default">
                <div class="card-header">
                    <h3 class="card-title">UserDetails</h3>

                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-tool" data-card-widget="remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <!-- /.card-header -->
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Name:</label>
                                @Html.TextBoxFor(var => var.vUserName, new { @class = "form-control", placeholder = "Enter UserName" })
                                @Html.ValidationMessageFor(var => var.vUserName)
                            </div>
                            <!-- /.form-group -->
                            <div class="form-group">
                                <label>Phone</label>
                                @Html.TextBoxFor(var => var.vUserPhoneNo, new { @class = "form-control", placeholder = "Enter phone" })
                                @Html.ValidationMessageFor(var => var.vUserPhoneNo)
                            </div>
                            <!-- /.form-group -->
                        </div>
                        <!-- /.col -->
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Gst Tin NUmber</label>
                                @Html.TextBoxFor(var => var.vPartyGSTIN, new { @class = "form-control", placeholder = "Enter gst tin" })
                                @Html.ValidationMessageFor(var => var.vPartyGSTIN)
                            </div>
                            <!-- /.form-group -->
                            <div class="form-group">
                                <label>Address</label>
                                @Html.TextBoxFor(var => var.vAddress, new { @class = "form-control", placeholder = "Enter phone" })
                                @Html.ValidationMessageFor(var => var.vAddress)

                            </div>
                            <!-- /.form-group -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                    <!-- /.row -->
                </div>
                <!-- /.card-body -->

            </div>
            <div class="card card-default">
                <div class="card-header">
                    <h3 class="card-title">DriverDetails</h3>

                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-tool" data-card-widget="remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <!-- /.card-header -->
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label>Driver Name:</label>
                                @Html.TextBoxFor(var => var.vDriverName, new { @class = "form-control", placeholder = "Enter DriverName" })
                                @Html.ValidationMessageFor(var => var.vDriverName)
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label>Driver Phone</label>
                                @Html.TextBoxFor(var => var.vDriverPhoneNo, new { @class = "form-control", placeholder = "Enter Driverphone" })
                                @Html.ValidationMessageFor(var => var.vDriverPhoneNo)
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label>Vehicle Number</label>
                                @Html.TextBoxFor(var => var.vVehicleNo, new { @class = "form-control", placeholder = "Enter phone" })
                                @Html.ValidationMessageFor(var => var.vVehicleNo)
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label>Vehicle Type</label>
                                @Html.DropDownListFor(var => var.iVehicleType, Model.VehicleType, new { @class = "form-control" })
                                @Html.ValidationMessageFor(var => var.vVehicleNo)
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row">

                                <div class="col">
                                    <div class="form-group">
                                        <label>From / To Place</label>
                                        @Html.TextBoxFor(var => var.vFromToPlace, new { @class = "form-control", placeholder = "Enter From" })
                                        @Html.ValidationMessageFor(var => var.vFromToPlace)
                                    </div>
                                </div>


                                <div class="col">
                                    <div class="form-group">
                                        <label>Start & EndDate</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="far fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                            @Html.TextBoxFor(var => var.dStartingDate, new { @class = "form-control float-right", @id = "reservation", placeholder = "Enter Date" })
                                            @Html.ValidationMessageFor(var => var.dStartingDate)
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label>Holiday Days</label>
                                        @Html.TextBoxFor(var => var.iHoliday, new { @class = "form-control Holiday", placeholder = "Enter Holiday Days" })
                                        @Html.ValidationMessageFor(var => var.iHoliday)

                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label>Total Days</label>
                                        @Html.TextBoxFor(var => var.iTotalDays, new { @class = "form-control TotalDays", placeholder = "Enter To" , @readonly = "readonly" })
                                        @Html.ValidationMessageFor(var => var.iTotalDays)
                                    </div>
                                </div>


                            </div>
                        </div>

                        <!-- /.col -->

                        <div class="col-md-12">
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label>Start Km</label>
                                        @Html.TextBoxFor(var => var.iStartingKM, new { @class = "form-control SKM", placeholder = "Enter StartKM" })
                                        @Html.ValidationMessageFor(var => var.iStartingKM)

                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label>Close Km</label>
                                        @Html.TextBoxFor(var => var.iClosingKM, new { @class = "form-control CKM", placeholder = "Enter CloseKM" })
                                        @Html.ValidationMessageFor(var => var.iClosingKM)
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label>Total Km</label>
                                        @Html.TextBoxFor(var => var.iTotalKM, new { @class = "form-control TKM", placeholder = "Enter Total KM" ,@readonly = "readonly" })
                                        @Html.ValidationMessageFor(var => var.iTotalKM)
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label>Per Km Charges</label>
                                        @Html.TextBoxFor(var => var.mPerKMChangres, new { @class = "form-control Per_Km_Charges", placeholder = "Enter Per Km" })
                                        @Html.ValidationMessageFor(var => var.mPerKMChangres)

                                    </div>
                                </div>




                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label>Per Day Charges</label>
                                        @Html.TextBoxFor(var => var.mPerDayChangres, new { @class = "form-control Per_Day_Charges", placeholder = "Enter Per Day Charge" })
                                        @Html.ValidationMessageFor(var => var.mPerDayChangres)

                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label>Night Charges</label>
                                        @Html.TextBoxFor(var => var.mNightChangres, new { @class = "form-control Night_Charges", placeholder = "Enter Night Charges" })
                                        @Html.ValidationMessageFor(var => var.mNightChangres)

                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label>Toll & Parking</label>
                                        @Html.TextBoxFor(var => var.mTollTaxAndParking, new { @class = "form-control Toll", placeholder = "Toll Tax & Parking" })
                                        @Html.ValidationMessageFor(var => var.mTollTaxAndParking)
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label>Tax Type</label>

                                        <select class="form-control selecttaxtype">
     
                                            <option value="0">State Tax</option>
                                            <option value="1">Capital</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label>Amount Befor Tax</label>
                                        @Html.TextBoxFor(var => var.mTotalAmountBeforeTax, new { @class = "form-control TotalAmountBeforeTax", placeholder = "Toll Tax & Parking" })
                                        @Html.ValidationMessageFor(var => var.mTotalAmountBeforeTax)
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <hr />
                                </div>
                                <!-- accepted payments column -->
                                <div class="col-6">
                                    <table class="table table-responsive table-bordered table-striped table-dark" style="display:table">
                                        <tbody>
                                            <tr>
                                                <td style="text-align:center">Bank Details</td>

                                            </tr>
                                            <tr>
                                                <td>Bank : Kotak Mahindra Bank</td>

                                            </tr>
                                            <tr>
                                                <td>Bank A/C : 9113287827</td>

                                            </tr>
                                            <tr>
                                                <td>Bank IFSC: KKBK0000295</td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                                <!-- /.col -->
                                <div class="col-6">


                                    <div class="table-responsive" id="WorkContent">

                                        @Html.Partial("_TaxGrid", Model.TravelTaxList)

                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <div class="row">

                                @Html.TextBoxFor(var => var.mTotalAmount, new { @class = "form-control mTotalAmount", @style = "display:none" })
                                @Html.TextBoxFor(var => var.Taxitemlist, new { @class = "form-control Taxitemlist" , @style = "display:none" })
                                <div class="col"> <button type="submit" class="btn btn-primary">Submit</button></div>
                            </div>
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                    <!-- /.row -->
                </div>
                <!-- /.card-body -->

            </div>
        </div>
    }
</section>

<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

<script>

    $(document).ready(function () {


        function CalculateDays() {
            var StartDate = $('#reservation').val().split('-')[0];
            var EndDate = $('#reservation').val().split('-')[1];

            // To set two dates to two variables
            var date1 = new Date(StartDate);
            var date2 = new Date(EndDate);

            // To calculate the time difference of two dates
            var Difference_In_Time = date2.getTime() - date1.getTime();

            // To calculate the no. of days between two dates
            var Difference_In_Days = Difference_In_Time / (1000 * 3600 * 24);

            Difference_In_Days = ((Difference_In_Days + 1) - ($('.Holiday').val()));

            if (Difference_In_Days < 0)
                $('.TotalDays').val("");
            else
                $('.TotalDays').val(Difference_In_Days);

            CalculateAmount();
        }


        function CalculateAmount() {

          
            var TotalDays = parseInt($('.TotalDays').val());
            var TotalKM = parseInt($('.TKM').val());
            var Per_Km_Charges = parseInt($('.Per_Km_Charges').val());
            var Per_Day_Charges = parseInt($('.Per_Day_Charges').val());
            var Night_Charges = parseInt($('.Night_Charges').val());
            
            var Toll = parseInt($('.Toll').val());

            var TotalAmount = 0;

            if (TotalDays > 0) {
 
                TotalAmount = ((TotalDays * Per_Day_Charges) + (Night_Charges + Toll));
            }

            

            $('.TotalAmountBeforeTax').val(TotalAmount);

            //if (TotalDays > 0) {

            //    TotalAmount = ((TotalKM * Per_Km_Charges) + (Night_Charges + Toll));
            //}
        }

        //$('.Per_Day_Charges, .Night_Charges, .Toll, .TotalDays').on('change', function () {
        //    CalculateAmount();
        //});
         

        $('#reservation, .Holiday').on('change', function () {
            CalculateDays();
        });

        //$('.Holiday').on('change', function () {
        //    CalculateDays();
        //});


        $('.CKM, .SKM').on('change', function () {

            var TotalKM = (parseInt($('.CKM').val()) - parseInt($('.SKM').val()));
            $('.TKM').val(TotalKM); 
        });

    
        
         
        $(".Per_Day_Charges, .Night_Charges, .Toll, .Per_Km_Charges, .CKM, .SKM, .Holiday, .TotalAmountBeforeTax").on("input", function (evt) {
            var self = $(this);
            self.val(self.val().replace(/[^0-9\.]/g, ''));
            if ((evt.which != 46 || self.val().indexOf('.') != -1) && (evt.which < 48 || evt.which > 57)) {
                evt.preventDefault();
            }
        });
 
    });
</script>